# Изменение пола контакта в Битрикс24

Проект представляет собой простое приложени на Python для автоматического изменения пола нового контакта в Битрикс24 на основе его имени. Приложения и база данных упакованы в контейнер Docker и запускаются с помощью Docker Compose.

## Описание

Приложение позволяет автоматизировать процесс обновления пола контактов в учетной записи Битрикс24. Он анализирует имя контакта и, используя базу данных с соответствиями имен к полу, автоматически обновляет пол контакта.

## Установка

1. Убедитесь, что у вас установлен Docker и Docker Compose.
2. Склонируйте репозиторий с помощью следующей команды:
```
git clone https://github.com/ezulex/bitrixContactGenderEdit.git
```
3. Перейдите в каталог проекта:
```
cd bitrixContactGenderEdit
```
## Настройка Битрикс24
1. Создайте новое поле Пол в карточке контакта, тип Список, с вариантами Мужчина и Женщина.
2. Получите ID и значения нового поля, для этого:
    - Создайте входящий вебхук для метода `crm.contact.fields`
    - Выполните запрос в браузере или Posman по сгенерированной ссылке
    - Найдите ID и значение нового поля, это будет запись вида:
   ```
   "UF_CRM_1713965966244": {
            "type": "enumeration",
            "isRequired": false,
            "isReadOnly": false,
            "isImmutable": false,
            "isMultiple": false,
            "isDynamic": true,
            "items": [
                {
                    "ID": "45",
                    "VALUE": "Мужчина"
                },
                {
                    "ID": "47",
                    "VALUE": "Женщина"
                }
            ],
            "title": "UF_CRM_1713965966244",
            "listLabel": "Пол",
            "formLabel": "Пол",
            "filterLabel": "Пол",
            "settings": {
                "DISPLAY": "UI",
                "LIST_HEIGHT": 1,
                "CAPTION_NO_VALUE": "",
                "SHOW_NO_VALUE": "Y"
            }
        }
   ```
   - Скопируйте ID поля, в данном примере `UF_CRM_1713965966244`
   - Скопируйте ID значений, в данном примере `45` для Мужчины и `47` для Женщины
   - При настройке приложения добавьте эти значения в окружение, в `BITRIX_AREA_ID`, `BITRIX_AREA_MAN`, `BITRIX_AREA_WOMAN`
2. Создайте входящий вебхук для метода `crm.contact.get`
2. Создайте входящий вебхук для метода `crm.contact.update`
3. Создайте исходящий вебхук для события `Создание контакта (ONCRMCONTACTADD)` и укажите URL вашего обработчика `http://АДРЕС_ВАШЕГО_СЕРВЕРА/webhook`\
*Подробнее о создании вебхуков можно прочитать в [базе знаний Битрикс24.](https://helpdesk.bitrix24.ru/open/20886106/
)*
## Настройка приложения

1. Создайте или измените файл `.env` в корневом каталоге проекта и укажите в нем параметры подключения к вашему Битрикс24, например:
```
BITRIX_DOMAIN = "b24-0633fw"
BITRIX_USER_ID = '1'
BITRIX_AUTH_KEY = '4moixxm2q8rtct5k'
BITRIX_AREA_ID = 'UF_CRM_1713965966244'
BITRIX_AREA_MAN = '45'
BITRIX_AREA_WOMAN = '47'
DB_USER = "postgres"
DB_PASSWORD = "12345"
DB_HOST = "db"
DB_PORT = "5432"
DB_DATABASE = "postgres"
```  
`BITRIX_DOMAIN`, `BITRIX_USER_ID` и `BITRIX_AUTH_KEY` из сгенерированной ссылки вебхука в Битрикс24.  

https://`b24-0633fw`.bitrix24.ru/rest/`1`/`ur0glc7ppzga0wzj`

2. Заполните файл `init.sql` данными для начального заполнения базы данных. В проекте он заполнен минимальным количеством значений.
3. Проверьте файл `docker-compose.yml` на предмет корректности настроек и путей к вашим файлам и данным.
4. Замените в 
## Использование

1. Запустите контейнеры с помощью команды:
```
docker-compose up -d
```
2. Скрипт будет запущен автоматически в контейнере и начнет обрабатывать данные контактов в вашей учетной записи Битрикс24.
3. Создайте контакт в Битрикс24 и поле Пол автоматически изменится, если имя найдено в базе данных.